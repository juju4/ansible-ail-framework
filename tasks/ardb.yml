---

- name: git clone ARDB
  git:
    repo: https://github.com/yinqiwen/ardb.git
    dest: "{{ ardb_root }}"
    version: "{{ ardb_version | default('v0.9.7') }}"
  ignore_errors: true

# failing in kitchen/lxd
- name: Allow extract with different owner
  replace:
    dest: "{{ ardb_root }}/src/Makefile"
    regexp: "tar jxf "
    replace: "tar --no-same-owner -jxf "

- name: build ARDB
  command: make
  args:
    chdir: "{{ ardb_root }}"
    creates: "{{ ardb_root }}/src/ardb-repair"
  async: 1800
  poll: 60
